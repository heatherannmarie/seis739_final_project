<section id="page-title">
    <h2 id="section-header">Store</h2>

    @if (mode === "parent") {
    <button class="add-item-btn" (click)="openAddItemModal()">+ Add New Item</button>

    <!-- Add Item Modal -->
    @if (showAddItemModal) {
    <div class="modal-overlay" (click)="closeAddItemModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h2>Add New Store Item</h2>
            <form (ngSubmit)="onSubmit()">
                <div class="form-group">
                    <label for="itemName">Item Name</label>
                    <input type="text" id="itemName" [(ngModel)]="itemName" name="itemName" required>
                </div>

                <div class="form-group">
                    <label for="itemPrice">Item Price ($)</label>
                    <input type="number" id="itemPrice" [(ngModel)]="itemPrice" name="itemPrice" min="0" step="0.01"
                        required>
                </div>

                <div class="form-group">
                    <label for="itemQuantity">Quantity</label>
                    <input type="number" id="itemQuantity" [(ngModel)]="itemQuantity" name="itemQuantity" min="1"
                        required>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="add-btn">Add Item</button>
                    <button type="button" (click)="closeAddItemModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    }
    }
</section>

<div class="store-grid">
    @for (item of inventory; track item.itemID) {
    <div class="store-card">
        @if (editingItem?.itemID === item.itemID) {
        <!-- Edit Mode -->
        <form (ngSubmit)="saveItemEdit()">
            <div class="form-group">
                <label>Item Name</label>
                <input type="text" [(ngModel)]="editItemName" name="editItemName" required>
            </div>
            <div class="form-group">
                <label>Price ($)</label>
                <input type="number" [(ngModel)]="editItemPrice" name="editItemPrice" min="0" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <input type="number" [(ngModel)]="editItemQuantity" name="editItemQuantity" min="0" required>
            </div>
            <div class="edit-actions">
                <button type="submit" class="save-btn">Save</button>
                <button type="button" (click)="cancelItemEdit()" class="cancel-btn">Cancel</button>
                <button type="button" (click)="deleteItem(item.itemID)" class="delete-btn">Delete</button>
            </div>
        </form>
        } @else {
        <!-- View Mode -->
        <h3>{{ item.itemName }}</h3>
        <p>Price: ${{ item.itemPrice.toFixed(2) }}</p>
        <p>In Stock: {{ item.availableInventory }}</p>
        @if (item.availableInventory > 0) {
        <span class="available">Available</span>
        @if (mode === "child") {
        <button (click)="purchaseItem(item.itemID)" class="purchase-btn">Purchase</button>
        }
        } @else {
        <span class="out-of-stock">Out of Stock</span>
        }
        @if (mode === "parent") {
        <button (click)="startItemEdit(item)" class="edit-btn">Edit</button>
        }
        }
    </div>
    } @empty {
    <div class="no-store-message">
        <p>{{ mode === 'parent' ? 'No items added to inventory yet. Add an item to get started!' :
            'No items available right now. Check back later!' }}</p>
    </div>
    }
</div>