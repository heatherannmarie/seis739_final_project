<section id="page-title">

    <h2 id="section-header">Chores</h2>

    @if (mode === 'parent') {
    <button class="add-chore-btn" (click)="openAddChoreModal()">+ Add New Chore</button>

    @if (showAddChoreModal) {
    <div class="modal-overlay" (click)="closeAddChoreModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h2>Add New Chore</h2>
            <form id="add-chore" (ngSubmit)="onSubmit()">
                <div class="form-group">
                    <label for="choreName">Chore Name</label>
                    <input type="text" id="choreName" [(ngModel)]="choreName" name="choreName" required>
                </div>

                <div class="form-group">
                    <label for="chorePrice">Chore Price ($)</label>
                    <input type="number" id="chorePrice" [(ngModel)]="chorePrice" name="chorePrice" min="0" step="0.01"
                        required>
                </div>

                <div class="form-group">
                    <label for="choreDescription">Description</label>
                    <textarea id="choreDescription" [(ngModel)]="choreDescription" name="choreDescription" rows="3"
                        required></textarea>
                </div>

                <div class="form-group">
                    <label for="assignedChild">Assigned Child (Optional)</label>
                    <select id="assignedChild" [(ngModel)]="assignedChild" name="assignedChild">
                        <option value="">-- None --</option>
                        @for (child of availableChildren; track child.childId) {
                        <option [value]="child.childId">{{ child.name }}</option>
                        }
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="save-btn">Add Chore</button>
                    <button type="button" (click)="closeAddChoreModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    }
    }
</section>

<div class="chore-grid">
    @for (chore of chores; track chore.choreId) {
    <div class="chore-card">
        @if (editingChore?.choreId === chore.choreId) {

        <form (ngSubmit)="saveChoreEdit()">
            <div class="form-group">
                <label>Chore Name</label>
                <input type="text" [(ngModel)]="editChoreName" name="editChoreName" required>
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" [(ngModel)]="editChoreDescription" name="editChoreDescription" required>
            </div>
            <div class="form-group">
                <label>Price ($)</label>
                <input type="number" [(ngModel)]="editChorePrice" name="editChorePrice" min="0" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Assigned Child ID</label>
                <input type="text" [(ngModel)]="editChoreAssignedChild" name="editChoreAssignedChild">
            </div>
            <div class="edit-actions">
                <button type="submit" class="save-btn">Save</button>
                <button type="button" (click)="cancelChoreEdit()" class="cancel-btn">Cancel</button>
                <button type="button" (click)="deleteChore(chore.choreId)" class="delete-btn">Delete</button>
            </div>
        </form>
        } @else {

        <h3>{{ chore.choreName }}</h3>
        <p>{{ chore.choreDescription }}</p>
        <p>Price: ${{ chore.chorePrice }}</p>
        <p>Status: {{ chore.status }}</p>

        @if (mode === 'parent') {
        <button (click)="startChoreEdit(chore)" class="edit-btn">Edit</button>
        @if (chore.status === 'PENDING') {
        <button (click)="approveChore(chore.choreId)">Approve Completion</button>
        <button (click)="denyChore(chore.choreId)">Deny</button>
        }
        } @else {
        @if (chore.status === 'AVAILABLE') {
        <button (click)="requestCompletion(chore.choreId)">Request Completion</button>
        } @else if (chore.status === 'PENDING') {
        <span class="pending-badge">Awaiting Approval</span>
        } @else {
        <span class="completed-badge">Completed</span>
        }
        }
        }
    </div>
    } @empty {
    <div class="no-chores-message">
        <p>{{ mode === 'parent' ? 'No chores created yet. Add a chore to get started!' :
            'No chores available right now. Check back later!' }}</p>
    </div>
    }
</div>